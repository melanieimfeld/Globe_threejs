<!doctype html>
<html>
<head>
<!-- <link href="index.css" rel="stylesheet" type="text/css"> -->
<head>
<meta charset="UTF-8">

<script src="js/three.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/OrbitControls.js"></script>
<script src="js/trackballControls.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>


<style>


body {
    font-family: Monospace;
    background-color: #a8ddf8;
    margin: 0px;
    overflow: hidden;
}

</style>

</head>

<body onLoad="init()">
<script>

var controls, scene, camera, box, spline, counter = 0;

var tangent = new THREE.Vector3();
var axis = new THREE.Vector3();
var up = new THREE.Vector3(0, 1, 0);

function init() {
    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 5000);
    camera.position.set(0, 0, 600);
    camera.lookAt(new THREE.Vector3(0, 100, 0));
    scene = new THREE.Scene();
    controls = new THREE.TrackballControls(camera, render.domElement);

    ///-----creating the catmull rom curve-----
    var numPoints = 50;

    spline = new THREE.CatmullRomCurve3([
    new THREE.Vector3(0, 0, 0),
    new THREE.Vector3(0, 200, 0),
    new THREE.Vector3(150, 150, 0),
    new THREE.Vector3(150, 50, 0),
    new THREE.Vector3(250, 100, 0),
    new THREE.Vector3(250, 300, 0)]);

    var material = new THREE.LineBasicMaterial({
        color: 0xff00f0,
    });
    var splinePoints = spline.getPoints(numPoints);
    var geometry = new THREE.BufferGeometry().setFromPoints(splinePoints);
    

    console.log("spline points", splinePoints);

    var line = new THREE.Line(geometry, material);
    scene.add(line);
    //------creating a box-------------

    geometry = new THREE.BoxGeometry(5, 40, 4);
    material = new THREE.MeshBasicMaterial({
        color: 0xff0000
    });

    box = new THREE.Mesh(geometry, material);
    scene.add(box);

    animate();

    //----this is where the magic happens-------
    setInterval(moveBox, 100);
}

function moveBox() {
    if (counter <= 1) {
        box.position.copy( spline.getPointAt(counter) );

        tangent = spline.getTangentAt(counter).normalize();

        axis.crossVectors(up, tangent).normalize();

        var radians = Math.acos(up.dot(tangent));

        box.quaternion.setFromAxisAngle(axis, radians);

        counter += 0.005
    } else {
        counter = 0;
    }
}

function animate() {
    requestAnimationFrame(animate);
    render();
}

function render() {
    controls.update();
    renderer.render(scene, camera);
}

</script>

</body>